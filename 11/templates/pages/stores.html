<!DOCTYPE html>
<html lang="vi" class="scroll-smooth">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tất cả cửa hàng</title>

  <!-- Framework CSS để xây dựng giao diện -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Thiết lập màu sắc, font và hiệu ứng chung cho Paw Joy -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['"Plus Jakarta Sans"', 'sans-serif'],
            serif: ['"Playfair Display"', 'serif'],
          },
          colors: {
            brand: '#D97706',
            brandLight: '#FFFBEB',
            brandDark: '#92400E',
            accent: '#059669',
            dark: '#3F2212',
            slate: '#1F2937',
            cream: '#FDFBF7',
            paper: '#F3F4F6',
          },
          boxShadow: {
            soft: '0 20px 40px -15px rgba(0, 0, 0, 0.05)',
          },
        },
      },
    }
  </script>

  <!-- Font chữ sử dụng cho toàn website -->
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="../../assets/css/style.css" />
  <link rel="stylesheet" href="../../assets/css/christmas-theme.css" />
  
  <!-- Thư viện icon (lọc, mũi tên, địa điểm,…) -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <!-- Tuỳ chỉnh dropdown & thanh cuộn -->
  <style>
    select {
      cursor: pointer;
    }
    select option {
      padding: 12px;
      background: white;
      color: #1F2937;
    }
    select option:hover {
      background: #FDFBF7;
    }
    select:focus option:checked {
      background: #FFFBEB;
    }
    /* Thanh cuộn */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #d97706;
      border-radius: 4px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #b45309;
    }
    /* Hiển thị footer trên màn hình desktop */
    @media (min-width: 1024px) {
      .footer-content {
        display: block !important;
        opacity: 1 !important;
        height: auto !important;
        margin-top: 1.5rem;
        pointer-events: auto;
      }
      .footer-arrow {
        display: none !important;
      }
      .footer-heading {
        pointer-events: none !important;
        cursor: default !important;
        justify-content: flex-start !important;
      }
      .footer-col {
        border-bottom: none !important;
        margin-bottom: 0 !important;
        padding-bottom: 0 !important;
      }
    }
  </style>
</head>

<body class="font-sans text-dark bg-cream antialiased">
  <!-- Christmas Snow Container -->
  <div id="snow-container" class="fixed inset-0 pointer-events-none z-10"></div>

  <!-- HEADER -->
  <div id="header"></div>

  <!-- NỘI DUNG CHÍNH -->
  <div class="min-h-screen bg-cream pt-20 md:pt-24 pb-16">
    <div class="container mx-auto px-6">
      <!-- Tiêu đề và mô tả trang -->
      <div class="mb-12">
        <h1 class="font-serif text-4xl md:text-5xl font-bold text-dark mb-4">Tất cả cửa hàng</h1>
        <p class="text-gray-600 text-lg">Khám phá mạng lưới các cửa hàng chăm sóc thú cưng uy tín</p>
      </div>

      <!-- BỘ LỌC -->
      <div class="mb-8 bg-white rounded-2xl p-6 shadow-soft">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-2">
            <i class="fas fa-filter text-brand"></i>
            <span class="text-sm font-bold text-dark">Bộ lọc</span>
          </div>
          <button
            onclick="toggleFilterSection()"
            class="flex items-center gap-2 text-sm text-gray-600 hover:text-brand font-medium transition"
            id="filterToggleBtn">
            <span id="filterToggleText">Hiển thị bộ lọc</span>
            <i class="fas fa-chevron-down transition-transform duration-300" id="filterToggleIcon"></i>
          </button>
        </div>
        <div id="filterContent" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
          <!-- Lọc theo vị trí -->
          <div class="relative lg:col-span-2">
            <label class="block text-xs font-semibold text-gray-600 mb-2">Vị trí</label>
            <div class="bg-white border border-gray-200 rounded-lg p-3 max-h-48 overflow-y-auto custom-scrollbar">
              <div class="space-y-2">
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition border-b border-gray-200 pb-2 mb-1">
                  <input type="checkbox" id="selectAllLocations" class="w-4 h-4 text-brand focus:ring-brand rounded">
                  <span class="text-sm font-bold text-dark">Tất cả</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="q1">
                  <span class="text-sm text-dark">Quận 1</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="q2">
                  <span class="text-sm text-dark">Quận 2</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="q3">
                  <span class="text-sm text-dark">Quận 3</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="q4">
                  <span class="text-sm text-dark">Quận 4</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="q5">
                  <span class="text-sm text-dark">Quận 5</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="q6">
                  <span class="text-sm text-dark">Quận 6</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="q7">
                  <span class="text-sm text-dark">Quận 7</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="q8">
                  <span class="text-sm text-dark">Quận 8</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="q9">
                  <span class="text-sm text-dark">Quận 9</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="q10">
                  <span class="text-sm text-dark">Quận 10</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="q11">
                  <span class="text-sm text-dark">Quận 11</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="q12">
                  <span class="text-sm text-dark">Quận 12</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="tanphu">
                  <span class="text-sm text-dark">Tân Phú</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="thuduc">
                  <span class="text-sm text-dark">Thủ Đức</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="binhthanh">
                  <span class="text-sm text-dark">Bình Thạnh</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="tanbinh">
                  <span class="text-sm text-dark">Tân Bình</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="phunhuan">
                  <span class="text-sm text-dark">Phú Nhuận</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded transition">
                  <input type="checkbox" class="location-checkbox w-4 h-4 text-brand focus:ring-brand rounded" value="govap">
                  <span class="text-sm text-dark">Gò Vấp</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Lọc theo dịch vụ -->
          <div class="relative">
            <label class="block text-xs font-semibold text-gray-600 mb-2">Dịch vụ</label>
            <div class="relative">
              <select
                id="filterService"
                class="w-full appearance-none bg-white border border-gray-200 rounded-lg px-4 py-2.5 pr-10 text-sm font-medium text-dark focus:outline-none focus:border-brand focus:ring-2 focus:ring-brand/10 transition shadow-sm hover:shadow-md hover:border-gray-300">
                <option value="all">Tất cả</option>
                <option value="spa">Spa</option>
                <option value="vet">Thăm khám</option>
              </select>
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
              </div>
            </div>
          </div>

          <!-- Lọc theo giá -->
          <div class="relative">
            <label class="block text-xs font-semibold text-gray-600 mb-2">Giá cả</label>
            <div class="relative">
              <select
                id="filterPrice"
                class="w-full appearance-none bg-white border border-gray-200 rounded-lg px-4 py-2.5 pr-10 text-sm font-medium text-dark focus:outline-none focus:border-brand focus:ring-2 focus:ring-brand/10 transition shadow-sm hover:shadow-md hover:border-gray-300">
                <option value="all">Tất cả</option>
                <option value="min-low-to-high">Giá thấp nhất: Thấp → Cao</option>
                <option value="min-high-to-low">Giá thấp nhất: Cao → Thấp</option>
                <option value="max-low-to-high">Giá cao nhất: Thấp → Cao</option>
                <option value="max-high-to-low">Giá cao nhất: Cao → Thấp</option>
              </select>
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
              </div>
            </div>
          </div>

          <!-- Lọc theo đánh giá -->
          <div class="relative">
            <label class="block text-xs font-semibold text-gray-600 mb-2">Đánh giá</label>
            <div class="relative">
              <select
                id="filterRating"
                class="w-full appearance-none bg-white border border-gray-200 rounded-lg px-4 py-2.5 pr-10 text-sm font-medium text-dark focus:outline-none focus:border-brand focus:ring-2 focus:ring-brand/10 transition shadow-sm hover:shadow-md hover:border-gray-300">
                <option value="all">Tất cả</option>
                <option value="high-to-low">Đánh giá cao đến thấp</option>
                <option value="low-to-high">Đánh giá thấp đến cao</option>
              </select>
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
              </div>
            </div>
          </div>

          <!-- Lọc theo khuyến mãi -->
          <div class="relative">
            <label class="block text-xs font-semibold text-gray-600 mb-2">Khuyến mãi</label>
            <div class="relative">
              <select
                id="filterPromo"
                class="w-full appearance-none bg-white border border-gray-200 rounded-lg px-4 py-2.5 pr-10 text-sm font-medium text-dark focus:outline-none focus:border-brand focus:ring-2 focus:ring-brand/10 transition shadow-sm hover:shadow-md hover:border-gray-300">
                <option value="all">Tất cả</option>
                <option value="yes">Có khuyến mãi</option>
                <option value="no">Không có khuyến mãi</option>
              </select>
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
              </div>
            </div>
          </div>
        </div>
        <!-- Nhóm nút thao tác của bộ lọc -->
        <div id="filterActions" class="hidden mt-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
          <!-- Đặt lại bộ lọc -->
          <button
            onclick="resetFilters()"
            class="text-sm text-gray-600 hover:text-brand font-medium transition flex items-center gap-2">
            <i class="fas fa-redo text-xs"></i>
            Đặt lại bộ lọc
          </button>
          <!-- Áp dụng bộ lọc -->
          <button
            onclick="applyFilters()"
            class="px-5 py-3 bg-brand text-white font-bold rounded-xl shadow-sm hover:bg-brandDark transition flex items-center gap-2 justify-center">
            <i class="fas fa-check text-sm"></i>
            Áp dụng
          </button>
        </div>
      </div>

      <!-- DANH SÁCH CỬA HÀNG -->
      <div class="store-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="storeGrid">
        <!-- Stores will be loaded dynamically from JSON -->
        </div>

      <!-- Pagination -->
      <div class="mt-12 flex justify-center items-center gap-2">
        <button 
          id="prevPageBtn"
          onclick="changePage(currentPage - 1)"
          class="px-4 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 hover:bg-brand hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button 
          id="page1Btn"
          onclick="changePage(1)"
          class="px-4 py-2 rounded-xl bg-brand text-white font-bold">1</button>
        <button 
          id="page2Btn"
          onclick="changePage(2)"
          class="px-4 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 hover:bg-brand hover:text-white transition">2</button>
        <button 
          id="nextPageBtn"
          onclick="changePage(currentPage + 1)"
          class="px-4 py-2 rounded-xl bg-white border border-gray-200 text-gray-600 hover:bg-brand hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed">
          <i class="fas fa-chevron-right"></i>
        </button>
            </div>
          </div>
        </div>

  <!-- FOOTER -->
  <div id="footer"></div>

  <script>
    // ===== LOAD STORES DATA FROM JSON =====
    let storesData = {};
    
    async function loadStoresData() {
      try {
        const response = await fetch('../../data/stores.json');
        storesData = await response.json();
        console.log('Stores data loaded:', storesData);
        renderStores();
      } catch (error) {
        console.error('Error loading stores data:', error);
      }
    }

    // ===== RENDER STORES FROM JSON =====
    function renderStores() {
      const storeGrid = document.getElementById('storeGrid');
      if (!storeGrid) return;

      storeGrid.innerHTML = '';

      Object.keys(storesData).forEach(storeId => {
        const store = storesData[storeId];
        const servicesHtml = store.services.map(service => {
          if (service === 'spa') {
            return `<span class="bg-brandLight/95 backdrop-blur-sm text-brandDark text-[10px] font-semibold px-2 py-1 rounded-lg shadow-sm flex items-center gap-1 border border-brand/30">
                <i class="fas fa-spa text-[9px] text-brand"></i>
                <span>Spa</span>
            </span>`;
          } else if (service === 'vet') {
            return `<span class="bg-emerald-100/90 backdrop-blur-sm text-emerald-700 text-[10px] font-semibold px-2 py-1 rounded-lg shadow-sm flex items-center gap-1 border border-emerald-200/50">
                <i class="fas fa-stethoscope text-[9px]"></i>
                <span>Thăm khám</span>
            </span>`;
          }
          return '';
        }).join('');

        const priceText = store.priceMin >= 100 ? `Từ ${store.priceMin}k` : `Từ ${store.priceMin}K`;
        const promoValue = store.promo ? 'yes' : 'no';
        const servicesValue = store.services.join(',');

        const storeCard = document.createElement('div');
        storeCard.className = 'store-card bg-white rounded-2xl overflow-hidden shadow-soft hover:shadow-xl transition duration-300 transform hover:-translate-y-1';
        storeCard.setAttribute('data-location', store.location);
        storeCard.setAttribute('data-services', servicesValue);
        storeCard.setAttribute('data-price-min', store.priceMin);
        storeCard.setAttribute('data-price-max', store.priceMax);
        storeCard.setAttribute('data-rating', store.rating);
        storeCard.setAttribute('data-promo', promoValue);

        // Điều chỉnh đường dẫn logo từ stores.json (từ root) thành relative từ templates/pages/
        let logoPath = store.logo;
        if (logoPath.startsWith('assets/images/')) {
          logoPath = '../../' + logoPath;
        }
        
        storeCard.innerHTML = `
          <div class="relative store-card-image-container overflow-hidden">
            <img
              src="${logoPath}"
              alt="${store.name}"
              class="w-full h-48 object-cover store-card-image"
              onerror="this.src='../../assets/images/logo/LOGO PAWJOY.png'">
            <!-- ĐIỂM ĐÁNH GIÁ -->
            <div class="absolute top-3 right-3 bg-white/95 backdrop-blur-sm px-3 py-1.5 rounded-full flex items-center gap-1 shadow-lg">
              <i class="fas fa-star text-yellow-400 text-sm"></i>
              <span class="text-sm font-bold text-dark">${store.rating}</span>
            </div>
            <!-- PHÂN LOẠI DỊCH VỤ -->
            <div class="absolute top-3 left-3 flex flex-col gap-1.5">
              ${servicesHtml}
            </div>
          </div>
          <div class="p-6">
            <h3 class="font-serif text-xl font-bold text-dark mb-2">${store.name}</h3>
            <div class="flex items-start gap-2 mb-3">
              <i class="fas fa-map-marker-alt text-brand mt-1 text-sm"></i>
              <p class="text-sm text-gray-600 flex-1">${store.address}</p>
            </div>
            <div class="flex items-center gap-2 mb-4">
              <i class="fas fa-tag text-accent text-sm"></i>
              <span class="text-sm font-semibold text-dark">${priceText}</span>
            </div>
            <a
              href="stores-detail.html?id=${store.id}"
              class="w-full bg-brand hover:bg-brandDark text-white font-bold py-3 rounded-xl transition transform hover:scale-105 block text-center">
              Xem chi tiết
            </a>
          </div>
        `;

        storeGrid.appendChild(storeCard);
      });

      // Sau khi render xong, khởi tạo trang
      initializeStoresPage();
    }

    // ===== UPDATE STORE CARDS LIST AFTER RENDERING =====
    function updateStoreCardsList() {
      // Cập nhật lại danh sách storeCards sau khi render
      const newStoreCards = Array.from(document.querySelectorAll('.store-card'));
      storeCards.length = 0;
      storeCards.push(...newStoreCards);
    }

    // ===== TOGGLE FILTER SECTION =====
    function toggleFilterSection() {
      const filterContent = document.getElementById('filterContent');
      const filterActions = document.getElementById('filterActions');
      const filterToggleIcon = document.getElementById('filterToggleIcon');
      const filterToggleText = document.getElementById('filterToggleText');
      
      const isHidden = filterContent.classList.contains('hidden');
      
      if (isHidden) {
        // Mở bộ lọc
        filterContent.classList.remove('hidden');
        filterActions.classList.remove('hidden');
        filterToggleIcon.classList.add('rotate-180');
        filterToggleText.textContent = 'Ẩn bộ lọc';
      } else {
        // Đóng bộ lọc
        filterContent.classList.add('hidden');
        filterActions.classList.add('hidden');
        filterToggleIcon.classList.remove('rotate-180');
        filterToggleText.textContent = 'Hiển thị bộ lọc';
      }
    }


    // Tải header và footer từ components
    document.addEventListener("DOMContentLoaded", () => {
      fetch("../../templates/partials/header.html")
        .then((res) => res.text())
        .then((html) => (document.getElementById("header").innerHTML = html));

      fetch("../../templates/partials/footer.html")
        .then((res) => res.text())
        .then((html) => (document.getElementById("footer").innerHTML = html));
      
      // Load stores data từ JSON
      loadStoresData();
    });

    // Hiệu ứng header khi cuộn trang
    window.addEventListener('scroll', () => {
      const header = document.getElementById('main-header');
      if (window.scrollY > 50) {
        header.classList.add('shadow-md', 'bg-white/95');
        header.classList.remove('bg-cream/80');
      } else {
        header.classList.remove('shadow-md', 'bg-white/95');
        header.classList.add('bg-cream/80');
      }
    });

    // CHỨC NĂNG LỌC & PHÂN TRANG DANH SÁCH CỬA HÀNG
    // Danh sách tất cả thẻ cửa hàng
    const storeCards = Array.from(document.querySelectorAll('.store-card'));
    // Grid hiển thị cửa hàng
    const storeGrid = document.querySelector('.store-grid');
    // Số cửa hàng hiển thị trên mỗi trang
    const itemsPerPage = 6;
    // Trang hiện tại
    let currentPage = 1;
    // Danh sách cửa hàng sau khi lọc
    let filteredStores = [];

    function resetFilters() {
      // Bỏ chọn tất cả ô checkbox(bao gồm cả "Tất cả")
      const selectAllCheckbox = document.getElementById('selectAllLocations');
      if (selectAllCheckbox) selectAllCheckbox.checked = false;
      document.querySelectorAll('.location-checkbox').forEach(checkbox => {
        checkbox.checked = false;
      });
      document.getElementById('filterService').value = 'all';
      document.getElementById('filterPrice').value = 'all';
      document.getElementById('filterRating').value = 'all';
      document.getElementById('filterPromo').value = 'all';
      currentPage = 1;
      applyFilters();
    }

    function applyFilters() {
      // Reset về trang 1 khi áp dụng bộ lọc mới
      currentPage = 1;
      
      // Lấy danh sách người dùng đã chọn từ checkbox
      const selectedLocations = Array.from(document.querySelectorAll('.location-checkbox:checked')).map(cb => cb.value);
      // Lấy giá trị các bộ lọc đang được chọn
      const service = document.getElementById('filterService').value;
      const priceSort = document.getElementById('filterPrice').value;
      const ratingSort = document.getElementById('filterRating').value;
      const promo = document.getElementById('filterPromo').value;

      // Lọc danh sách cửa hàng theo điều kiện đã chọn
      const filtered = storeCards.filter(card => {
        const cardLocation = card.dataset.location;
        const cardServices = card.dataset.services.split(',');
        const cardPromo = card.dataset.promo;

        // Nếu người dùng có chọn vị trí, thì cửa hàng phải ở vị trí đó
        if (selectedLocations.length > 0 && !selectedLocations.includes(cardLocation)) return false;
        // Lọc theo dịch vụ
        if (service !== 'all' && !cardServices.includes(service)) return false;
        // Lọc theo khuyến mãi
        if (promo !== 'all' && cardPromo !== promo) return false;
        return true;
      });

      const getPriceValue = (card, type) => {
        const value = parseFloat(card.dataset[type === 'min' ? 'priceMin' : 'priceMax']);
        return value < 0 ? Number.POSITIVE_INFINITY : value;
      };

      const sortBy = [...filtered];
      if (priceSort !== 'all') {
        sortBy.sort((a, b) => {
          let priceA, priceB;
          
          // Xác định loại giá (min hoặc max) và hướng sắp xếp
          if (priceSort.startsWith('min-')) {
            priceA = getPriceValue(a, 'min');
            priceB = getPriceValue(b, 'min');
          } else if (priceSort.startsWith('max-')) {
            priceA = getPriceValue(a, 'max');
            priceB = getPriceValue(b, 'max');
          }
          
          // Xác định hướng sắp xếp (1 = tăng dần, -1 = giảm dần)
          const dir = priceSort.endsWith('low-to-high') ? 1 : -1;
          
          if (priceA === priceB) return 0;
          return (priceA - priceB) * dir;
        });
      } else if (ratingSort !== 'all') {
        sortBy.sort((a, b) => {
          const dir = ratingSort === 'low-to-high' ? 1 : -1;
          return (parseFloat(a.dataset.rating) - parseFloat(b.dataset.rating)) * dir;
        });
      } else {
        sortBy.sort((a, b) => Number(a.dataset.index) - Number(b.dataset.index));
      }

      filteredStores = sortBy;
      displayPage();
    }

    function displayPage() {
      // Ẩn tất cả các cửa hàng
      storeCards.forEach(card => {
        card.style.display = 'none';
      });

      // Tính toán các cửa hàng cần hiển thị cho trang hiện tại
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const storesToShow = filteredStores.slice(startIndex, endIndex);

      // Hiển thị các cửa hàng của trang hiện tại
      storesToShow.forEach(card => {
        card.style.display = '';
        storeGrid.appendChild(card);
      });

      // Cập nhật UI phân trang
      updatePaginationUI();
    }

    function changePage(page) {
      const totalPages = Math.ceil(filteredStores.length / itemsPerPage);
      if (page < 1 || page > totalPages) return;
      
      currentPage = page;
      displayPage();
      
      // Cuộn lên đầu trang
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function updatePaginationUI() {
      const totalPages = Math.ceil(filteredStores.length / itemsPerPage);
      const prevBtn = document.getElementById('prevPageBtn');
      const nextBtn = document.getElementById('nextPageBtn');
      const page1Btn = document.getElementById('page1Btn');
      const page2Btn = document.getElementById('page2Btn');

      // Cập nhật trạng thái nút Previous
      if (currentPage === 1) {
        prevBtn.disabled = true;
        prevBtn.classList.add('opacity-50', 'cursor-not-allowed');
      } else {
        prevBtn.disabled = false;
        prevBtn.classList.remove('opacity-50', 'cursor-not-allowed');
      }

      // Cập nhật trạng thái nút Next
      if (currentPage >= totalPages) {
        nextBtn.disabled = true;
        nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
      } else {
        nextBtn.disabled = false;
        nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
      }

      // Cập nhật trạng thái các nút trang
      if (currentPage === 1) {
        page1Btn.classList.add('bg-brand', 'text-white', 'font-bold');
        page1Btn.classList.remove('bg-white', 'text-gray-600', 'border', 'border-gray-200');
        page2Btn.classList.remove('bg-brand', 'text-white', 'font-bold');
        page2Btn.classList.add('bg-white', 'text-gray-600', 'border', 'border-gray-200');
      } else {
        page2Btn.classList.add('bg-brand', 'text-white', 'font-bold');
        page2Btn.classList.remove('bg-white', 'text-gray-600', 'border', 'border-gray-200');
        page1Btn.classList.remove('bg-brand', 'text-white', 'font-bold');
        page1Btn.classList.add('bg-white', 'text-gray-600', 'border', 'border-gray-200');
      }

      // Ẩn nút trang 2 nếu không có đủ cửa hàng
      if (totalPages < 2) {
        page2Btn.style.display = 'none';
      } else {
        page2Btn.style.display = '';
      }
    }

    // CHECKBOX "CHỌN TẤT CẢ" CHO VỊ TRÍ
    function handleSelectAllLocations() {
      const selectAllCheckbox = document.getElementById('selectAllLocations');
      const locationCheckboxes = document.querySelectorAll('.location-checkbox');
      
      // Nếu không tồn tại checkbox "Tất cả" thì dừng xử lý
      if (!selectAllCheckbox) return;
      
      // Khi người dùng bật / tắt checkbox "Tất cả"
      selectAllCheckbox.addEventListener('change', function() {
        // Đồng bộ trạng thái cho tất cả checkbox
        locationCheckboxes.forEach(checkbox => {
          checkbox.checked = this.checked;
        });
        // Áp dụng lại bộ lọc cửa hàng
        applyFilters();
      });
      
      // Khi người dùng thay đổi từng checkbox riêng lẻ
      locationCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const allChecked = Array.from(locationCheckboxes).every(cb => cb.checked); // Đã chọn hết
          const noneChecked = Array.from(locationCheckboxes).every(cb => !cb.checked); // Chưa chọn cái nào
          // Cập nhật trạng thái checkbox "Tất cả"
          selectAllCheckbox.checked = allChecked;
          selectAllCheckbox.indeterminate = !allChecked && !noneChecked;
          applyFilters();
        });
      });
    }

    // ===== APPLY FILTER FROM URL PARAMETER =====
    function applyFilterFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const serviceParam = urlParams.get('service');
      
      if (serviceParam) {
        const filterService = document.getElementById('filterService');
        if (filterService && (serviceParam === 'spa' || serviceParam === 'vet')) {
          filterService.value = serviceParam;
          // Mở filter section nếu đang ẩn
          const filterContent = document.getElementById('filterContent');
          const filterActions = document.getElementById('filterActions');
          const filterToggleIcon = document.getElementById('filterToggleIcon');
          const filterToggleText = document.getElementById('filterToggleText');
          if (filterContent && filterContent.classList.contains('hidden')) {
            filterContent.classList.remove('hidden');
            if (filterActions) filterActions.classList.remove('hidden');
            if (filterToggleIcon) filterToggleIcon.classList.add('rotate-180');
            if (filterToggleText) filterToggleText.textContent = 'Ẩn bộ lọc';
          }
        }
      }
    }

    // Khi trang "Danh sách cửa hàng" tải xong (sau khi stores đã được render)
    function initializeStoresPage() {
      // Đợi một chút để đảm bảo stores đã được render
      setTimeout(() => {
        updateStoreCardsList();
      storeCards.forEach((card, index) => {
        card.dataset.index = index;
      });
      handleSelectAllLocations();
        // Áp dụng filter từ URL nếu có
        applyFilterFromURL();
      applyFilters();
      }, 100);
    }
  </script>
  <script type="module" src="../../assets/js/lib/mobile-menu.js"></script>
  <script type="module" src="../../assets/js/lib/footer.js"></script>
  <script src="../../assets/js/lib/favorite-badge.js"></script>
  <script src="../../assets/js/scroll.js"></script>
  <script src="../../assets/js/christmas-snow.js"></script>

</body>

</html>
